import './global.css';
import { ThemeToggle } from './components/ThemeToggle';
import React from 'react';
import { NavAuth } from './components/NavAuth';
import Script from 'next/script';
import Link from 'next/link';
// import { cookies } from 'next/headers'; // Niet meer nodig voor SSR theme

export const metadata = {
  title: 'Avans - Keuzekompas',
  description: 'Generated by create-nx-workspace',
};

export default async function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en" suppressHydrationWarning>
      <head>
        <meta name="color-scheme" content="light dark" />

        <Script id="apply-theme" strategy="beforeInteractive"
          dangerouslySetInnerHTML={{
            __html: `
              try {
                // Prefer cookie (SSR parity), fallback to localStorage, then system
                var cookieMatch = document.cookie.match(/(?:^|; )kk-theme=([^;]+)/);
                var t = cookieMatch ? decodeURIComponent(cookieMatch[1]) : null;
                if (!t) { t = localStorage.getItem('kk-theme'); }
                if (!t && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                  t = 'dark';
                }
                // Apply early and hint UA widgets
                if (t === 'dark') {
                  document.documentElement.setAttribute('data-theme','dark');
                  document.documentElement.style.backgroundColor = '#121212';
                  document.documentElement.style.setProperty('color-scheme', 'dark');
                } else {
                  document.documentElement.removeAttribute('data-theme');
                  document.documentElement.style.removeProperty('color-scheme');
                  // Zorg ervoor dat de achtergrond van de light theme ook expliciet is ingesteld.
                  // De CSS body { background: var(--bg); } moet dit primair regelen.
                  document.documentElement.style.backgroundColor = '#f7f7f8'; 
                }
              } catch (_) {}
            `,
          }}
        />
      </head>
      <body>
        <header className="app-header">
          <div className="container app-header-inner">
            <div className="brand">Keuzekompas</div>
            <nav className="nav">
              <Link href="/" className="active">Home</Link>
              <Link href="/modules">Modules</Link>
              <Link href="/favorites">Favorieten</Link>
              <Link href="/profile">Profiel</Link>
              <NavAuth />
              <ThemeToggle />
            </nav>
          </div>
        </header>
        <main className="app-main">
          <div className="container">{children}</div>
        </main>
        <footer className="app-footer">
          <div className="container">Â© {new Date().getFullYear()} Keuzekompas</div>
        </footer>
      </body>
    </html>
  );
}